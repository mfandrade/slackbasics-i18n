<!-- $Id: printing.xml,v 1.7 2005/03/04 16:23:32 daniel Exp $ -->

<chapter id="printing"> <?dbhtml filename="printer.html"?>
  <title>Printer configuration</title>

  <sect1 id="printing-intro">
    <title>Introduction</title>

    <para>
      &OS; supports a large share of the available USB, parallel and
      network printers. &Distribution; provides two printing systems,
      <acronym>CUPS</acronym> (Common UNIX Printing System) and
      <acronym>LPRNG</acronym> (LPR Next Generation). This chapter covers
      the CUPS system.
    </para>

    <para>
      Independent of which printing system you are going to use, it is
      a good idea to install some printer filter collections. These can
      be found in the <quote>ap</quote> disk set. If you want to have
      support for most printers, make sure the following packages are
      installed:
    </para>

    <screen>
a2ps
enscript
espgs
gimp-print
gnu-gs-fonts
hpijs
ifhp
    </screen>

    <para>
      Both printing systems have their own advantages and disadvantages. If
      you do not have much experience with configuring printers under &OS;,
      it is a good idea to use CUPS, because CUPS provides a comfortable web
      interface which can be accessed through a web browser.
    </para> 

  </sect1>

  <sect1 id="printing-preparations">
    <title>Preparations</title>

    <para>
      To be able to use CUPS the <quote>cups</quote> package from the
      <quote>a</quote> disk set has to be installed. After the installation
      CUPS can be started automatically during each system boot by making
      <filename>/etc/rc.d/rc.cups</filename> executable. This can be
      done with the following command:
    </para>

    <screen>
# <command>chmod a+x /etc/rc.d/rc.cups</command>
    </screen>

    <para>
      After restarting the system CUPS will also be restarted automatically. 
      You can start CUPS on a running system by executing the following 
      command:
    </para>

    <screen>
# <command>/etc/rc.d/rc.cups start</command>
    </screen> 

  </sect1>

  <sect1 id="printing-configuration">
    <title>Configuration</title>

    <para>
      CUPS can be configured via a web interface. The configuration interface
      can be accessed with a web browser at the following URL:
      <ulink url="http://localhost:631/">http://localhost:631/</ulink>.
      Some parts of the web interface require that you authenticate yourself.
      If an authentication window pops up you can enter <quote>root</quote>
      as the user name, and fill in the root account password.
    </para>

    <para>
      A printer can be added to the CUPS configuration by clicking on
      <quote>Administrate</quote>, and clicking on the <quote>Add
      Printer</quote> button after that. The web interface will ask for 
      three options:
    </para>

    <itemizedlist>
      <listitem>
        <para>
          <emphasis>Name</emphasis> - the name of the printer. Use a simple
          name, for example <quote>epson</quote>.
        </para>
      </listitem>
      <listitem>
        <para>
          <emphasis>Location</emphasis> - the physical location of the printer.
          This setting is not crucial, but handy for larger organizations.
        </para>
      </listitem>
      <listitem>
        <para>
          <emphasis>Description</emphasis> - a description of the printer,
          for example <quote>Epson Stylus Color C42UX</quote>.
        </para>
      </listitem>
    </itemizedlist> 

    <para>
      You can proceed by clicking the <quote>Continue</quote> button. On
      the next page you can configure how the printer is connected. If you
      have an USB printer which is turned on, the web interface will show
      the name of the printer next to the USB port that is used. After
      configuring the printer port you can select the printer brand and
      model. After that the printer configuration is finished, and the
      printer will be added to the CUPS configuration.
    </para>

    <para>
      An overview of the configured printers can be found on the
      <quote>Printers</quote> page. On this page you can also do some
      printer operations. For example, <quote>Print Test Page</quote>
      can be used to check the printer configuration by printing a test
      page.
    </para>

  </sect1>
  
  <sect1 id="printing-accesscontrol">
    <title>Access control</title>
    
    <para>
      The CUPS printing system provides a web configuration interface, and
      remote printer access through the Internet Printing Protocol 
      (<acronym>IPP</acronym>). The CUPS configuration files allow you
      to configure fine-grained access control to printers. By default access 
      to printers is limited to <emphasis>localhost</emphasis>
      (<emphasis>127.0.0.1</emphasis>).
    </para>
    
    <para>
      You can refine access control in the central CUPS daemon configuration
      file, <filename>/etc/cups/cupsd.conf</filename>, which has a syntax
      that is comparable to the Apache configuration file. Access control
      is configured through <emphasis>Location</emphasis> sections. For
      example, the default global (IPP root directory) section looks like
      this:
    </para>
    
    <screen>
&lt;Location /&gt;
Order Deny,Allow
Deny From All
Allow From 127.0.0.1
&lt;/Location&gt;
    </screen>

    <para>
      As you can see deny statements are handled first, and then allow
      statements. In the default configuration access is denied from
      all hosts, except for <emphasis>127.0.0.1</emphasis>, 
      <emphasis>localhost</emphasis>. Suppose that you would like to
      allow hosts from the local network, which uses the 
      <emphasis>192.168.1.0/24</emphasis> address space, to use the
      printers on the system you are configuring CUPS on. In this
      case you could add the line that is bold:
    </para>

    <screen>
&lt;Location /&gt;
Order Deny,Allow
Deny From All
Allow From 127.0.0.1
<emphasis role="bold">Allow From 192.168.1.0/24</emphasis>
&lt;/Location&gt;
    </screen>

    <para>
      You can refine other locations in the address space by adding
      additional location sections. Settings for sub-directories override
      global settings. For example, you could restrict access to the
      <emphasis>epson</emphasis> printer to the hosts with IP addresses
      <emphasis>127.0.0.1</emphasis> and <emphasis>192.168.1.203</emphasis>
      by adding the following section:
    </para>

    <screen>
&lt;Location /printers/epson&gt;
Order Deny,Allow
Deny From All
Allow From 127.0.0.1
Allow From 192.168.1.203
&lt;/Location&gt;
    </screen>

  </sect1>

</chapter>
